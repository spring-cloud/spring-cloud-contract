<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Accurest</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Accurest</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#why">Why?</a></li>
<li><a href="#purposes">Purposes</a></li>
<li><a href="#client-side">Client Side</a></li>
<li><a href="#server-side">Server Side</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#additional-links">Additional links</a></li>
<li><a href="#samples">Samples</a></li>
</ul>
</li>
<li><a href="#contract-dsl">Contract DSL</a>
<ul class="sectlevel2">
<li><a href="#limitations">Limitations</a></li>
<li><a href="#http-top-level-elements">HTTP Top-Level Elements</a></li>
<li><a href="#request">Request</a></li>
<li><a href="#response">Response</a></li>
<li><a href="#regular-expressions">Regular expressions</a></li>
<li><a href="#passing-optional-parameters">Passing optional parameters</a></li>
<li><a href="#executing-custom-methods-on-server-side">Executing custom methods on server side</a></li>
<li><a href="#jax-rs-support">JAX-RS support</a></li>
<li><a href="#messaging-top-level-elements">Messaging Top-Level Elements</a></li>
</ul>
</li>
<li><a href="#accurest-http">Accurest HTTP</a>
<ul class="sectlevel2">
<li><a href="#gradle-project">Gradle Project</a></li>
<li><a href="#using-in-your-maven-project">Using in your Maven project</a></li>
<li><a href="#scenarios">Scenarios</a></li>
</ul>
</li>
<li><a href="#accurest-messaging">Accurest Messaging</a>
<ul class="sectlevel2">
<li><a href="#integrations">Integrations</a></li>
<li><a href="#manual-integration">Manual Integration</a></li>
<li><a href="#publisher-side-test-generation">Publisher side test generation</a></li>
<li><a href="#consumer-stub-side-generation">Consumer Stub Side generation</a></li>
</ul>
</li>
<li><a href="#stub-runner">Stub Runner</a>
<ul class="sectlevel2">
<li><a href="#publishing-stubs-as-jars">Publishing stubs as JARs</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#stub-runner-core">Stub Runner Core</a></li>
<li><a href="#stub-runner-boot">Stub Runner Boot</a></li>
<li><a href="#stub-runner-junit-rule">Stub Runner JUnit Rule</a></li>
<li><a href="#stub-runner-spring">Stub Runner Spring</a></li>
<li><a href="#stub-runner-spring-cloud">Stub Runner Spring Cloud</a></li>
<li><a href="#common-properties-for-junit-and-spring">Common properties for JUnit and Spring</a></li>
</ul>
</li>
<li><a href="#stub-runner-for-messaging">Stub Runner for Messaging</a>
<ul class="sectlevel2">
<li><a href="#stub-triggering">Stub triggering</a></li>
<li><a href="#stub-runner-messaging-camel">Stub Runner Messaging Camel</a></li>
<li><a href="#stub-runner-messaging-integration">Stub Runner Messaging Integration</a></li>
<li><a href="#stub-runner-messaging-stream">Stub Runner Messaging Stream</a></li>
</ul>
</li>
<li><a href="#migration-guide">Migration Guide</a>
<ul class="sectlevel2">
<li><a href="#migration-to-0-4-7">Migration to 0.4.7</a></li>
<li><a href="#migration-to-1-0-0-rc1">Migration to 1.0.0-RC1</a></li>
<li><a href="#migration-to-1-1-0">Migration to 1.1.0</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Adam Dudczak, Marcin Grzejszczak, Jakub Kubryński, Karol Lassak, Olga Maciaszek-Sharma, Mariusz Smykuła</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just to make long story short - Accurest is a tool that enables Consumer Driven Contract (CDC) development of JVM-based applications. It is shipped
with <em>Contract Definition Language</em> (DSL). Contract definitions are used by Accurest to produce following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSON stub definitions to be used by Wiremock when doing integration testing on the client code (<em>client tests</em>).
Test code must still be written by hand, test data is produced by Accurest.</p>
</li>
<li>
<p>Messaging routes if you&#8217;re using one. We&#8217;re integrating with Spring Integration, Spring Cloud Stream and Apache Camel. You can however set your own integrations if you want to</p>
</li>
<li>
<p>Acceptance tests (in JUnit or Spock) used to verify if server-side implementation of the API is compliant with the contract (<em>server tests</em>). Full test is generated by Accurest.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Accurest moves TDD to the level of software architecture.</p>
</div>
<div class="sect2">
<h3 id="why">Why?</h3>
<div class="paragraph">
<p>Let us assume that we have a system comprising of multiple microservices:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Deps.png" alt="Microservices Architecture">
</div>
</div>
<div class="sect3">
<h4 id="testing-issues">Testing issues</h4>
<div class="paragraph">
<p>If we wanted to test the application in top left corner if it can communicate with other services then we could do one of two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deploy all microservices and perform end to end tests</p>
</li>
<li>
<p>mock other microservices in unit / integration tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both have their advantages but also a lot of disadvantages. Let&#8217;s focus on the latter.</p>
</div>
<div class="paragraph">
<p><strong>Deploy all microservices and perform end to end tests</strong></p>
</div>
<div class="paragraph">
<p>Advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>simulates production</p>
</li>
<li>
<p>tests real communication between services</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to test one microservice we would have to deploy 6 microservices, a couple of databases etc.</p>
</li>
<li>
<p>the environment where the tests would be conducted would be locked for a single suite of tests (i.e. nobody else would be able to run the tests in the meantime).</p>
</li>
<li>
<p>long to run</p>
</li>
<li>
<p>very late feedback</p>
</li>
<li>
<p>extremely hard to debug</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Mock other microservices in unit / integration tests</strong></p>
</div>
<div class="paragraph">
<p>Advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>very fast feedback</p>
</li>
<li>
<p>no infrastructure requirements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the implementor of the service creates stubs thus they might have nothing to do with the reality</p>
</li>
<li>
<p>you can go to production with passing tests and failing production</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To solve the aforementioned issues Accurest with Stub Runner were created. Their main idea is to give you very fast feedback, without the need
to set up the whole world of microservices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Stubs1.png" alt="Stubbed Services">
</div>
</div>
<div class="paragraph">
<p>If you work on stubs then the only applications you need are those that your application is using directly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Stubs2.png" alt="Stubbed Services">
</div>
</div>
<div class="paragraph">
<p>Accurest gives you the certainty that the stubs that you&#8217;re using were created by the service that you&#8217;re calling. Also if you can use them it means that they were
tested against the producer&#8217;s side. In other words - you can trust those stubs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="purposes">Purposes</h3>
<div class="paragraph">
<p>The main purposes of Accurest with Stub Runner are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to ensure that WireMock / Messaging stubs (used when developing the client) are doing exactly what actual server-side implementation will do,</p>
</li>
<li>
<p>to promote ATDD method and Microservices architectural style,</p>
</li>
<li>
<p>to provide a way to publish changes in contracts that are immediately visible on both sides,</p>
</li>
<li>
<p>to generate boilerplate test code used on the server side.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="client-side">Client Side</h3>
<div class="paragraph">
<p>During the tests you want to have a Wiremock instance / Messaging route up and running that simulates the service Y.
You would like to feed that instance with a proper stub definition. That stub definition would need
to be valid and should also be reusable on the server side.</p>
</div>
<div class="paragraph">
<p><em>Summing it up:</em> On this side, in the stub definition, you can use patterns for request stubbing and you need exact
values for responses.</p>
</div>
</div>
<div class="sect2">
<h3 id="server-side">Server Side</h3>
<div class="paragraph">
<p>Being a service Y since you are developing your stub, you need to be sure that it&#8217;s actually resembling your
concrete implementation. You can&#8217;t have a situation where your stub acts in one way and your application on
production behaves in a different way.</p>
</div>
<div class="paragraph">
<p>That&#8217;s why from the provided stub acceptance tests will be generated that will ensure
that your application behaves in the same way as you define in your stub.</p>
</div>
<div class="paragraph">
<p><em>Summing it up:</em> On this side, in the stub definition, you need exact values as request and can use patterns/methods
for response verification.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependencies">Dependencies</h3>
<div class="paragraph">
<p>Accurest and Stub Runner are using the following libraries</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiremock.org/">WireMock</a></p>
</li>
<li>
<p><a href="https://github.com/jayway/JsonPath">Jayway JSONPath</a></p>
</li>
<li>
<p><a href="https://github.com/marcingrzejszczak/jsonassert">JSONAssert from Marcin Grzejszczak</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="additional-links">Additional links</h3>
<div class="paragraph">
<p>Below you can find some resources related to Accurest and Stub Runner. Note that some can be outdated since the Accurest project
is under constant development.</p>
</div>
<div class="sect3">
<h4 id="videos">Videos</h4>
<div class="paragraph">
<p><strong>Olga Maciaszek-Sharma talking about Accurest</strong></p>
</div>
<div class="videoblock">
<div class="content">
<iframe src="https://www.youtube.com/embed/daafmTYFoDU?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p><strong>Marcin Grzejszczak and Jakub Kubryński talking about Accurest</strong></p>
</div>
<div class="videoblock">
<div class="content">
<iframe src="https://player.vimeo.com/video/130779882" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect3">
<h4 id="readings">Readings</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.slideshare.net/MarcinGrzejszczak/stick-to-the-rules-consumer-driven-contracts-201507-confitura">Slides from Marcin Grzejszczak&#8217;s talk about Accurest</a></p>
</li>
<li>
<p><a href="http://toomuchcoding.com/blog/categories/accurest/">Accurest related articles from Marcin Grzejszczak&#8217;s blog</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="samples">Samples</h3>
<div class="paragraph">
<p>Here you can find some <a href="https://github.com/Codearte/accurest-samples">working samples</a>. Check the readme of each project for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contract-dsl">Contract DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Contract DSL in Accurest is written in Groovy, but don&#8217;t be alarmed if you didn&#8217;t use Groovy before. Knowledge of the language is not really needed as our DSL uses only
a tiny subset of it (namely literals, method calls and closures). What&#8217;s more, Accurest&#8217;s DSL is designed to be programmer-readable without any knowledge of the DSL itself -
 it&#8217;s statically typed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Since 1.1.0 you can use the <code>io.codearte.accurest.dsl.Accurest</code> class in your DSL files.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s look at full example of a contract definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                method <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>
                url <span class="string"><span class="delimiter">'</span><span class="content">/api/12</span><span class="delimiter">'</span></span>
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/vnd.com.ofg.twitter-places-analyzer.v1+json</span><span class="delimiter">'</span></span>
                }
                body <span class="string"><span class="delimiter">'''</span><span class="content">\
</span><span class="content">                [{
                        &quot;created_at&quot;: &quot;Sat Jul 26 09:38:57 +0000 2014&quot;,
                        &quot;id&quot;: 492967299297845248,
                        &quot;id_str&quot;: &quot;492967299297845248&quot;,
                        &quot;text&quot;: &quot;Gonna see you at Warsaw&quot;,
                        &quot;place&quot;:
                        {
                                &quot;attributes&quot;:{},
                                &quot;bounding_box&quot;:
                                {
                                        &quot;coordinates&quot;:
                                                [[
                                                        [-77.119759,38.791645],
                                                        [-76.909393,38.791645],
                                                        [-76.909393,38.995548],
                                                        [-77.119759,38.995548]
                                                ]],
                                        &quot;type&quot;:&quot;Polygon&quot;
                                },
                                &quot;country&quot;:&quot;United States&quot;,
                                &quot;country_code&quot;:&quot;US&quot;,
                                &quot;full_name&quot;:&quot;Washington, DC&quot;,
                                &quot;id&quot;:&quot;01fbe706f872cb32&quot;,
                                &quot;name&quot;:&quot;Washington&quot;,
                                &quot;place_type&quot;:&quot;city&quot;,
                                &quot;url&quot;: &quot;http://api.twitter.com/1/geo/id/01fbe706f872cb32.json&quot;
                        }
                }]
        </span><span class="delimiter">'''</span></span>
        }
        response {
                status <span class="integer">200</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not all features of the DSL are used in example above. If you didn&#8217;t find what you are looking for, please check next paragraphs on this page.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>You can easily compile Accurest Contracts to WireMock stubs mapping using standalone maven command: <code>mvn io.codearte.accurest:accurest-maven-plugin:convert</code>.</p>
</div>
</blockquote>
</div>
<div class="sect2">
<h3 id="limitations">Limitations</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Accurest doesn&#8217;t support XML properly. Please use JSON or help us implement this feature.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Accurest supports equality check on text response. Regular expressions are not yet available.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="http-top-level-elements">HTTP Top-Level Elements</h3>
<div class="paragraph">
<p>Following methods can be called in the top-level closure of a contract definition. Request and response are mandatory, priority is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        <span class="comment">// Definition of HTTP request part of the contract</span>
        <span class="comment">// (this can be a valid request or invalid depending</span>
        <span class="comment">// on type of contract being specified).</span>
        request {
                <span class="comment">//...</span>
        }

        <span class="comment">// Definition of HTTP response part of the contract</span>
        <span class="comment">// (a service implementing this contract should respond</span>
        <span class="comment">// with following response after receiving request</span>
        <span class="comment">// specified in &quot;request&quot; part above).</span>
        response {
                <span class="comment">//...</span>
        }

        <span class="comment">// Contract priority, which can be used for overriding</span>
        <span class="comment">// contracts (1 is highest). Priority is optional.</span>
        priority <span class="integer">1</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="request">Request</h3>
<div class="paragraph">
<p>HTTP protocol requires only <strong>method and address</strong> to be specified in a request. The same information is mandatory in request definition of Accurest contract.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">// HTTP request method (GET/POST/PUT/DELETE).</span>
                method <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>

                <span class="comment">// Path component of request URL is specified as follows.</span>
                urlPath(<span class="string"><span class="delimiter">'</span><span class="content">/users</span><span class="delimiter">'</span></span>)
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to specify whole <code>url</code> instead of just path, but <code>urlPath</code> is the recommended way as it makes the tests <strong>host-independent</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                method <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>

                <span class="comment">// Specifying `url` and `urlPath` in one contract is illegal.</span>
                url(<span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8888/users</span><span class="delimiter">'</span></span>)
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Request may contain <strong>query parameters</strong>, which are specified in a closure nested in a call to <code>urlPath</code> or <code>url</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">//...</span>

                urlPath(<span class="string"><span class="delimiter">'</span><span class="content">/users</span><span class="delimiter">'</span></span>) {

                        <span class="comment">// Each parameter is specified in form</span>
                        <span class="comment">// `'paramName' : paramValue` where parameter value</span>
                        <span class="comment">// may be a simple literal or one of matcher functions,</span>
                        <span class="comment">// all of which are used in this example.</span>
                        queryParameters {

                                <span class="comment">// If a simple literal is used as value</span>
                                <span class="comment">// default matcher function is used (equalTo)</span>
                                parameter <span class="string"><span class="delimiter">'</span><span class="content">limit</span><span class="delimiter">'</span></span>: <span class="integer">100</span>

                                <span class="comment">// `equalTo` function simply compares passed value</span>
                                <span class="comment">// using identity operator (==).</span>
                                parameter <span class="string"><span class="delimiter">'</span><span class="content">filter</span><span class="delimiter">'</span></span>: equalTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>)

                                <span class="comment">// `containing` function matches strings</span>
                                <span class="comment">// that contains passed substring.</span>
                                parameter <span class="string"><span class="delimiter">'</span><span class="content">gender</span><span class="delimiter">'</span></span>: value(stub(containing(<span class="string"><span class="delimiter">&quot;</span><span class="content">[mf]</span><span class="delimiter">&quot;</span></span>)), server(<span class="string"><span class="delimiter">'</span><span class="content">mf</span><span class="delimiter">'</span></span>))

                                <span class="comment">// `matching` function tests parameter</span>
                                <span class="comment">// against passed regular expression.</span>
                                parameter <span class="string"><span class="delimiter">'</span><span class="content">offset</span><span class="delimiter">'</span></span>: value(stub(matching(<span class="string"><span class="delimiter">&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>)), server(<span class="integer">123</span>))

                                <span class="comment">// `notMatching` functions tests if parameter</span>
                                <span class="comment">// does not match passed regular expression.</span>
                                parameter <span class="string"><span class="delimiter">'</span><span class="content">loginStartsWith</span><span class="delimiter">'</span></span>: value(stub(notMatching(<span class="string"><span class="delimiter">&quot;</span><span class="content">.{0,2}</span><span class="delimiter">&quot;</span></span>)), server(<span class="integer">3</span>))
                        }
                }

                <span class="comment">//...</span>
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It may contain additional <strong>request headers</strong>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">//...</span>

                <span class="comment">// Each header is added in form `'Header-Name' : 'Header-Value'`.</span>
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
                }

                <span class="comment">//...</span>
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and a <strong>request body</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">//...</span>

                <span class="comment">// JSON and XML formats of request body are supported.</span>
                <span class="comment">// Format will be determined from a header or body's content.</span>
                body <span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;login&quot; : &quot;john&quot;, &quot;name&quot;: &quot;John The Contract&quot; }</span><span class="delimiter">'''</span></span>
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Body&#8217;s format</strong> can also be specified explicitly by invoking one of format functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">//...</span>

                <span class="comment">// In this case body will be formatted as XML.</span>
                body equalToXml(
                                <span class="string"><span class="delimiter">'''</span><span class="content">&lt;user&gt;&lt;login&gt;john&lt;/login&gt;&lt;name&gt;John The Contract&lt;/name&gt;&lt;/user&gt;</span><span class="delimiter">'''</span></span>
                )
        }

        response {
                <span class="comment">//...</span>
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="response">Response</h3>
<div class="paragraph">
<p>Minimal response must contain <strong>HTTP status code</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                <span class="comment">//...</span>
        }
        response {
                <span class="comment">// Status code sent by the server</span>
                <span class="comment">// in response to request specified above.</span>
                status <span class="integer">200</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides status response may contain <strong>headers</strong> and <strong>body</strong>, which are specified the same way as in the request (see previous paragraph).</p>
</div>
</div>
<div class="sect2">
<h3 id="regular-expressions">Regular expressions</h3>
<div class="paragraph">
<p>You can use regular expressions to write your requests in Contract DSL. It is particularly useful when you want to indicate that a given response
should be provided for requests that follow a given pattern. Also, you can use it when you need to use patterns and not exact values both
for your test and your server side tests.</p>
</div>
<div class="paragraph">
<p>Please see the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                method(<span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>)
                url <span class="error">$</span>(client(~<span class="regexp"><span class="delimiter">/</span><span class="char">\/</span><span class="content">[0-9]{2}</span><span class="delimiter">/</span></span>), server(<span class="string"><span class="delimiter">'</span><span class="content">/12</span><span class="delimiter">'</span></span>))
        }
        response {
                status <span class="integer">200</span>
                body(
                                <span class="key">id</span>: value(
                                                client(<span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>),
                                                server(regex(<span class="string"><span class="delimiter">'</span><span class="content">[0-9]+</span><span class="delimiter">'</span></span>))
                                ),
                                <span class="key">surname</span>: <span class="error">$</span>(
                                                client(<span class="string"><span class="delimiter">'</span><span class="content">Kowalsky</span><span class="delimiter">'</span></span>),
                                                server(<span class="string"><span class="delimiter">'</span><span class="content">Lewandowski</span><span class="delimiter">'</span></span>)
                                ),
                                <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Jan</span><span class="delimiter">'</span></span>,
                                <span class="key">created</span>: <span class="error">$</span>(client(<span class="string"><span class="delimiter">'</span><span class="content">2014-02-02 12:23:43</span><span class="delimiter">'</span></span>), server(execute(<span class="string"><span class="delimiter">'</span><span class="content">currentDate(it)</span><span class="delimiter">'</span></span>))),
                                <span class="key">correlationId</span>: value(client(<span class="string"><span class="delimiter">'</span><span class="content">5d1f9fef-e0dc-4f3d-a7e4-72d2220dd827</span><span class="delimiter">'</span></span>),
                                                server(regex(<span class="string"><span class="delimiter">'</span><span class="content">[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}</span><span class="delimiter">'</span></span>))
                                )
                )
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">text/plain</span><span class="delimiter">'</span></span>
                }
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="passing-optional-parameters">Passing optional parameters</h3>
<div class="paragraph">
<p>It is possible to provide optional parameters in your contract. It&#8217;s only possible to have optional parameter for the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>STUB</em> side of the Request</p>
</li>
<li>
<p><em>TEST</em> side of the Response</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        priority <span class="integer">1</span>
        request {
                method <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>
                url <span class="string"><span class="delimiter">'</span><span class="content">/users/password</span><span class="delimiter">'</span></span>
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
                }
                body(
                                <span class="key">email</span>: <span class="error">$</span>(stub(optional(regex(email()))), test(<span class="string"><span class="delimiter">'</span><span class="content">abc@abc.com</span><span class="delimiter">'</span></span>)),
                                <span class="key">callback_url</span>: <span class="error">$</span>(stub(regex(hostname())), test(<span class="string"><span class="delimiter">'</span><span class="content">http://partners.com</span><span class="delimiter">'</span></span>))
                )
        }
        response {
                status <span class="integer">404</span>
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
                }
                body(
                                <span class="key">code</span>: value(stub(<span class="string"><span class="delimiter">&quot;</span><span class="content">123123</span><span class="delimiter">&quot;</span></span>), test(optional(<span class="string"><span class="delimiter">&quot;</span><span class="content">123123</span><span class="delimiter">&quot;</span></span>)))
                )
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By wrapping a part of the body with the <code>optional()</code> method you are in fact creating a regular expression that should be present 0 or more times.</p>
</div>
<div class="paragraph">
<p>That way for the example above the following test would be generated if you pick Spock:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
 given:
  def request = given()
    .header('Content-Type', 'application/json')
    .body('''{&quot;email&quot;:&quot;abc@abc.com&quot;,&quot;callback_url&quot;:&quot;http://partners.com&quot;}''')

 when:
  def response = given().spec(request)
    .post(&quot;/users/password&quot;)

 then:
  response.statusCode == 404
  response.header('Content-Type')  == 'application/json'
 and:
  DocumentContext parsedJson = JsonPath.parse(response.body.asString())
  assertThatJson(parsedJson).field(&quot;code&quot;).matches(&quot;(123123)?&quot;)
</span><span class="delimiter">&quot;&quot;&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following stub:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span><span class="string"><span class="delimiter">'</span><span class="content">
{
  &quot;request&quot; : {
    &quot;url&quot; : &quot;/users/password&quot;,
    &quot;method&quot; : &quot;POST&quot;,
    &quot;bodyPatterns&quot; : [ {
      &quot;matchesJsonPath&quot; : &quot;$[?(@.email =~ /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+</span><span class="char">\\</span><span class="char">\\</span><span class="content">.[a-zA-Z]{2,4})?/)]&quot;
    }, {
      &quot;matchesJsonPath&quot; : &quot;$[?(@.callback_url =~ /((http[s]?|ftp):</span><span class="char">\\</span><span class="char">\\</span><span class="content">/)</span><span class="char">\\</span><span class="char">\\</span><span class="content">/?([^:</span><span class="char">\\</span><span class="char">\\</span><span class="content">/</span><span class="char">\\</span><span class="char">\\</span><span class="content">s]+)(:[0-9]{1,5})?/)]&quot;
    } ],
    &quot;headers&quot; : {
      &quot;Content-Type&quot; : {
        &quot;equalTo&quot; : &quot;application/json&quot;
      }
    }
  },
  &quot;response&quot; : {
    &quot;status&quot; : 404,
    &quot;body&quot; : &quot;{</span><span class="char">\\</span><span class="content">&quot;code</span><span class="char">\\</span><span class="content">&quot;:</span><span class="char">\\</span><span class="content">&quot;123123</span><span class="char">\\</span><span class="content">&quot;,</span><span class="char">\\</span><span class="content">&quot;message</span><span class="char">\\</span><span class="content">&quot;:</span><span class="char">\\</span><span class="content">&quot;User not found by email == [not.existing@user.com]</span><span class="char">\\</span><span class="content">&quot;}&quot;,
    &quot;headers&quot; : {
      &quot;Content-Type&quot; : &quot;application/json&quot;
    }
  },
  &quot;priority&quot; : 1
}
</span><span class="delimiter">'</span></span><span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executing-custom-methods-on-server-side">Executing custom methods on server side</h3>
<div class="paragraph">
<p>It is also possible to define a method call to be executed on the server side during the test. Such a method can be added to the class defined as "baseClassForTests"
in the configuration. Please see the examples below:</p>
</div>
<div class="sect3">
<h4 id="groovy-dsl">Groovy DSL</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        request {
                method <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>
                url <span class="error">$</span>(client(regex(<span class="string"><span class="delimiter">'</span><span class="content">^/api/[0-9]{2}$</span><span class="delimiter">'</span></span>)), server(<span class="string"><span class="delimiter">'</span><span class="content">/api/12</span><span class="delimiter">'</span></span>))
                headers {
                        header <span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>
                }
                body <span class="string"><span class="delimiter">'''</span><span class="content">\
</span><span class="content">                                [{
                                        &quot;text&quot;: &quot;Gonna see you at Warsaw&quot;
                                }]
                        </span><span class="delimiter">'''</span></span>
        }
        response {
                body (
                                <span class="key">path</span>: <span class="error">$</span>(client(<span class="string"><span class="delimiter">'</span><span class="content">/api/12</span><span class="delimiter">'</span></span>), server(regex(<span class="string"><span class="delimiter">'</span><span class="content">^/api/[0-9]{2}$</span><span class="delimiter">'</span></span>))),
                                <span class="key">correlationId</span>: <span class="error">$</span>(client(<span class="string"><span class="delimiter">'</span><span class="content">1223456</span><span class="delimiter">'</span></span>), server(execute(<span class="string"><span class="delimiter">'</span><span class="content">isProperCorrelationId($it)</span><span class="delimiter">'</span></span>)))
                )
                status <span class="integer">200</span>
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="base-mock-spec">Base Mock Spec</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">BaseMockMvcSpec</span> <span class="directive">extends</span> Specification {

        <span class="keyword">def</span> <span class="function">setup</span>() {
                RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> PairIdController())
        }

        <span class="type">void</span> isProperCorrelationId(<span class="predefined-type">Integer</span> correlationId) {
                <span class="keyword">assert</span> correlationId == <span class="integer">123456</span>
        }

        <span class="type">void</span> isEmpty(<span class="predefined-type">String</span> value) {
                <span class="keyword">assert</span> value == <span class="predefined-constant">null</span>
        }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jax-rs-support">JAX-RS support</h3>
<div class="paragraph">
<p>Starting with release 0.8.0 we support JAX-RS 2 Client API. Base class needs to define <code>protected WebTarget webTarget</code> and server initialization, right now the only option how to test JAX-RS API is to start a web server.</p>
</div>
<div class="paragraph">
<p>Request with a body needs to have a content type set otherwise <code>application/octet-stream</code> is going to be used.</p>
</div>
<div class="paragraph">
<p>In order to use JAX-RS mode, use the following settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testMode == <span class="string"><span class="delimiter">'</span><span class="content">JAXRSCLIENT</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of a test API generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
 // when:
  Response response = webTarget
    .path(&quot;/users&quot;)
    .queryParam(&quot;limit&quot;, &quot;10&quot;)
    .queryParam(&quot;offset&quot;, &quot;20&quot;)
    .queryParam(&quot;filter&quot;, &quot;email&quot;)
    .queryParam(&quot;sort&quot;, &quot;name&quot;)
    .queryParam(&quot;search&quot;, &quot;55&quot;)
    .queryParam(&quot;age&quot;, &quot;99&quot;)
    .queryParam(&quot;name&quot;, &quot;Denis.Stepanov&quot;)
    .queryParam(&quot;email&quot;, &quot;bob@email.com&quot;)
    .request()
    .method(&quot;GET&quot;);

  String responseAsString = response.readEntity(String.class);

 // then:
  assertThat(response.getStatus()).isEqualTo(200);
 // and:
  DocumentContext parsedJson = JsonPath.parse(responseAsString);
  assertThatJson(parsedJson).field(&quot;property1&quot;).isEqualTo(&quot;a&quot;);
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="messaging-top-level-elements">Messaging Top-Level Elements</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Feature available since 1.1.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DSL for messaging looks a little bit different than the one that focuses on HTTP.</p>
</div>
<div class="sect3">
<h4 id="output-triggered-by-a-method">Output triggered by a method</h4>
<div class="paragraph">
<p>The output message can be triggered by calling a method (e.g. a Scheduler was started and a message was sent)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dsl = GroovyDsl.make {
        <span class="comment">// Human readable description</span>
        description <span class="string"><span class="delimiter">'</span><span class="content">Some description</span><span class="delimiter">'</span></span>
        <span class="comment">// Label by means of which the output message can be triggered</span>
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        <span class="comment">// input to the contract</span>
        input {
                <span class="comment">// the contract will be triggered by a method</span>
                triggeredBy(<span class="string"><span class="delimiter">'</span><span class="content">bookReturnedTriggered()</span><span class="delimiter">'</span></span>)
        }
        <span class="comment">// output message of the contract</span>
        outputMessage {
                <span class="comment">// destination to which the output message will be sent</span>
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
                <span class="comment">// the body of the output message</span>
                body(<span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;bookName&quot; : &quot;foo&quot; }</span><span class="delimiter">'''</span></span>)
                <span class="comment">// the headers of the output message</span>
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the output message will be sent to <code>output</code> if a method called <code>bookReturnedTriggered</code> will be executed. In the message <strong>publisher&#8217;s</strong> side
we will generate a test that will call that method to trigger the message. On the <strong>consumer</strong> side you can use the <code>some_label</code> to trigger the message.</p>
</div>
</div>
<div class="sect3">
<h4 id="output-triggered-by-a-message">Output triggered by a message</h4>
<div class="paragraph">
<p>The output message can be triggered by receiving a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dsl = GroovyDsl.make {
        description <span class="string"><span class="delimiter">'</span><span class="content">Some Description</span><span class="delimiter">'</span></span>
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        <span class="comment">// input is a message</span>
        input {
                <span class="comment">// the message was received from this destination</span>
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">input</span><span class="delimiter">'</span></span>)
                <span class="comment">// has the following body</span>
                messageBody([
                        <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                <span class="comment">// and the following headers</span>
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
                body([
                        <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the output message will be sent to <code>output</code> if a proper message will be received on the <code>input</code> destination. In the message <strong>publisher&#8217;s</strong> side
we will generate a test that will send the input message to the defined destination. On the <strong>consumer</strong> side you can either send a message to the input
destination or use the <code>some_label</code> to trigger the message.</p>
</div>
</div>
<div class="sect3">
<h4 id="consumer-producer">Consumer / Producer</h4>
<div class="paragraph">
<p>In HTTP you have a notion of <code>client</code>/<code>stub and `server</code>/<code>test</code> notation. You can use them also in messaging but we&#8217;re providing also the <code>consumer</code> and <code>produer</code> methods
as presented below (note you can use either <code>$</code> or <code>value</code> methods to provide <code>consumer</code> and <code>producer</code> parts)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Accurest.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        input {
                messageFrom value(consumer(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>), producer(<span class="string"><span class="delimiter">'</span><span class="content">jms:input</span><span class="delimiter">'</span></span>))
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo <span class="error">$</span>(consumer(<span class="string"><span class="delimiter">'</span><span class="content">jms:input</span><span class="delimiter">'</span></span>), producer(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>))
                body([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
        }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accurest-http">Accurest HTTP</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="gradle-project">Gradle Project</h3>
<div class="sect3">
<h4 id="prerequisites">Prerequisites</h4>
<div class="paragraph">
<p>In order to use Accurest with Wiremock you have to use gradle or maven plugin.</p>
</div>
<div class="sect4">
<h5 id="add-gradle-plugin">Add gradle plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
        repositories {
                mavenCentral()
        }
        dependencies {
                classpath <span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest:accurest-gradle-plugin:${accurest_version}</span><span class="delimiter">'</span></span>
        }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">accurest</span><span class="delimiter">'</span></span>

dependencies {
        testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:2.4.6</span><span class="delimiter">'</span></span>
        testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.spockframework:spock-core:1.0-groovy-2.4</span><span class="delimiter">'</span></span>
        testCompile <span class="string"><span class="delimiter">'</span><span class="content">com.jayway.restassured:spring-mock-mvc:2.9.0</span><span class="delimiter">'</span></span> <span class="comment">// needed if you're going to use Spring MockMvc</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="add-maven-plugin">Add maven plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.codearte.accurest<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>accurest-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>convert<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateStubs<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateTests<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more: <a href="http://codearte.github.io/accurest-maven-plugin/">accurest-maven-plugin</a></p>
</div>
</div>
<div class="sect4">
<h5 id="add-stubs">Add stubs</h5>
<div class="paragraph">
<p>By default Accurest is looking for stubs in <code>src/test/resources/accurest</code> directory.</p>
</div>
<div class="paragraph">
<p>Directory containing stub definitions is treated as a class name, and each stub definition is treated as a single test.
We assume that it contains at least one directory which will be used as test class name. If there is more than one level of nested directories all except the last one will be used as package name.
So with following structure</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">src/test/resources/accurest/myservice/shouldCreateUser.groovy
src/test/resources/accurest/myservice/shouldReturnUser.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accurest will create test class <code>defaultBasePackage.MyService</code> with two methods</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shouldCreateUser()</code></p>
</li>
<li>
<p><code>shouldReturnUser()</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="run-plugin">Run plugin</h4>
<div class="paragraph">
<p>Plugin registers itself to be invoked before <code>check</code> task. You have nothing to do as long as you want it to be part of your build process. If you just want to generate tests please invoke <code>generateAccurest</code> task.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-plugin">Configure plugin</h4>
<div class="paragraph">
<p>To change default configuration just add <code>accurest</code> snippet to your Gradle config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">accurest {
        testMode = <span class="string"><span class="delimiter">'</span><span class="content">MockMvc</span><span class="delimiter">'</span></span>
        baseClassForTests = <span class="string"><span class="delimiter">'</span><span class="content">org.mycompany.tests</span><span class="delimiter">'</span></span>
        generatedTestSourcesDir = project.file(<span class="string"><span class="delimiter">'</span><span class="content">src/accurest</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="configuration-options">Configuration options</h5>
<div class="ulist">
<ul>
<li>
<p><strong>testMode</strong> - defines mode for acceptance tests. By default MockMvc which is based on Spring&#8217;s MockMvc. It can also be changed to <strong>JaxRsClient</strong> or to <strong>Explicit</strong> for real HTTP calls.</p>
</li>
<li>
<p><strong>imports</strong> - array with imports that should be included in generated tests (for example ['org.myorg.Matchers']). By default empty array []</p>
</li>
<li>
<p><strong>staticImports</strong> - array with static imports that should be included in generated tests(for example ['org.myorg.Matchers.*']). By default empty array []</p>
</li>
<li>
<p><strong>basePackageForTests</strong> - specifies base package for all generated tests. By default set to io.codearte.accurest.tests</p>
</li>
<li>
<p><strong>baseClassForTests</strong> - base class for generated tests. By default <code>spock.lang.Specification</code> if using Spock tests.</p>
</li>
<li>
<p><strong>ruleClassForTests</strong> - specifies Rule which should be added to generated test classes.</p>
</li>
<li>
<p><strong>ignoredFiles</strong> - Ant matcher allowing defining stub files for which processing should be skipped. By default empty array []</p>
</li>
<li>
<p><strong>contractsDslDir</strong> - directory containing contracts written using the GroovyDSL. By default <code>$rootDir/src/test/resources/accurest</code></p>
</li>
<li>
<p><strong>generatedTestSourcesDir</strong> - test source directory where tests generated from Groovy DSL should be placed. By default <code>$buildDir/generated-test-sources/accurest</code></p>
</li>
<li>
<p><strong>stubsOutputDir</strong> - dir where the generated Wiremock stubs from Groovy DSL should be placed</p>
</li>
<li>
<p><strong>targetFramework</strong> - the target test framework to be used; currently Spock and JUnit are supported with JUnit being the default framework</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="base-class-for-tests">Base class for tests</h5>
<div class="paragraph">
<p>When using Accurest in default MockMvc you need to create a base specification for all generated acceptance tests. In this class you need to point to endpoint which should be verified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">abstract</span> <span class="type">class</span> <span class="class">BaseMockMvcSpec</span> <span class="directive">extends</span> Specification {

        <span class="keyword">def</span> <span class="function">setup</span>() {
                RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> PairIdController())
        }

        <span class="type">void</span> isProperCorrelationId(<span class="predefined-type">Integer</span> correlationId) {
                <span class="keyword">assert</span> correlationId == <span class="integer">123456</span>
        }

        <span class="type">void</span> isEmpty(<span class="predefined-type">String</span> value) {
                <span class="keyword">assert</span> value == <span class="predefined-constant">null</span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of using <code>Explicit</code> mode, you can use base class to initialize the whole tested app similarly as in regular integration tests. In case of <code>JAXRSCLIENT</code> mode this base class
should also contain <code>protected WebTarget webTarget</code> field, right now the only option to test JAX-RS API is to start a web server.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="invoking-generated-tests">Invoking generated tests</h4>
<div class="paragraph">
<p>To ensure that provider side is complaint with defined contracts, you need to invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew generateAccurest test</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="accurest-on-consumer-side">Accurest on consumer side</h4>
<div class="paragraph">
<p>In consumer service you need to configure Accurest plugin in exactly the same way as in case of provider. If you don&#8217;t want to use Stub Runner then you need to copy contracts stored in
<code>src/test/resources/accurest</code> and generate WireMock json stubs using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew generateWireMockClientStubs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>stubsOutputDir</code> option has to be set for stub generation to work.</p>
</div>
<div class="paragraph">
<p>When present, json stubs can be used in consumer automated tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ContextConfiguration</span>(loader == SpringApplicationContextLoader, classes == Application)
<span class="type">class</span> <span class="class">LoanApplicationServiceSpec</span> <span class="directive">extends</span> Specification {

 <span class="annotation">@ClassRule</span>
 <span class="annotation">@Shared</span>
 WireMockClassRule wireMockRule == <span class="keyword">new</span> WireMockClassRule()

 <span class="annotation">@Autowired</span>
 LoanApplicationService sut

 <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should successfully apply for loan</span><span class="delimiter">'</span></span>() {
   <span class="key">given</span>:
         LoanApplication application =
                        <span class="keyword">new</span> LoanApplication(<span class="key">client</span>: <span class="keyword">new</span> Client(<span class="key">pesel</span>: <span class="string"><span class="delimiter">'</span><span class="content">12345678901</span><span class="delimiter">'</span></span>), <span class="key">amount</span>: <span class="float">123.123</span>)
   <span class="key">when</span>:
        LoanApplicationResult loanApplication == sut.loanApplication(application)
   <span class="key">then</span>:
        loanApplication.loanApplicationStatus === LoanApplicationStatus.LOAN_APPLIED
        loanApplication.rejectionReason === <span class="predefined-constant">null</span>
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Underneath LoanApplication makes a call to FraudDetection service. This request is handled by Wiremock server configured using stubs generated by Accurest.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-in-your-maven-project">Using in your Maven project</h3>
<div class="sect3">
<h4 id="add-maven-plugin-2">Add maven plugin</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.codearte.accurest<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>accurest-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>convert<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateStubs<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateTests<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Read more: <a href="http://codearte.github.io/accurest-maven-plugin/">accurest-maven-plugin</a></p>
</div>
</div>
<div class="sect3">
<h4 id="add-stubs-2">Add stubs</h4>
<div class="paragraph">
<p>By default Accurest is looking for stubs in <code>src/test/resources/accurest</code> directory.
Directory containing stub definitions is treated as a class name, and each stub definition is treated as a single test.
We assume that it contains at least one directory which will be used as test class name. If there is more than one level of nested directories all except the last one will be used as package name.
So with following structure</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">src/test/resources/accurest/myservice/shouldCreateUser.groovy
src/test/resources/accurest/myservice/shouldReturnUser.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accurest will create test class <code>defaultBasePackage.MyService</code> with two methods
 - <code>shouldCreateUser()</code>
 - <code>shouldReturnUser()</code></p>
</div>
</div>
<div class="sect3">
<h4 id="run-plugin-2">Run plugin</h4>
<div class="paragraph">
<p>Plugin goal <code>generateTests</code> is assigned to be invoked in phase <code>generate-test-sources</code>. You have nothing to do as long as you want it to be part of your build process. If you just want to generate tests please invoke <code>generateTests</code> goal.</p>
</div>
</div>
<div class="sect3">
<h4 id="configure-plugin-2">Configure plugin</h4>
<div class="paragraph">
<p>To change default configuration just add <code>configuration</code> section to plugin definition or <code>execution</code> definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.codearte.accurest<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>accurest-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>convert<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateStubs<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateTests<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;basePackageForTests&gt;</span>com.ofg.twitter.place<span class="tag">&lt;/basePackageForTests&gt;</span>
        <span class="tag">&lt;baseClassForTests&gt;</span>com.ofg.twitter.place.BaseMockMvcSpec<span class="tag">&lt;/baseClassForTests&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="important-configuration-options">Important configuration options</h5>
<div class="ulist">
<ul>
<li>
<p><strong>testMode</strong> - defines mode for acceptance tests. By default <code>MockMvc</code> which is based on Spring&#8217;s MockMvc. It can also be changed to <code>JaxRsClient</code> or to <code>Explicit</code> for real HTTP calls.</p>
</li>
<li>
<p><strong>basePackageForTests</strong> - specifies base package for all generated tests. By default set to <code>io.codearte.accurest.tests</code>.</p>
</li>
<li>
<p><strong>ruleClassForTests</strong> - specifies Rule which should be added to generated test classes.</p>
</li>
<li>
<p><strong>baseClassForTests</strong> - base class for generated tests. By default <code>spock.lang.Specification</code> if using Spock tests.</p>
</li>
<li>
<p><strong>contractsDir</strong> - directory containing contracts written using the GroovyDSL. By default <code>/src/test/resources/accurest</code>.</p>
</li>
<li>
<p><strong>testFramework</strong> - the target test framework to be used; currently Spock and JUnit are supported with Spock being the default framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For complete information take a look at <a href="http://codearte.github.io/accurest-maven-plugin/plugin-info.html">Plugin Documentation</a></p>
</div>
</div>
<div class="sect4">
<h5 id="base-class-for-tests-2">Base class for tests</h5>
<div class="literalblock">
<div class="content">
<pre>When using Accurest in default MockMvc you need to create a base specification for all generated acceptance tests. In this class you need to point to endpoint which should be verified.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.mycompany.tests

<span class="keyword">import</span> <span class="include">org.mycompany.ExampleSpringController</span>
<span class="keyword">import</span> <span class="include">com.jayway.restassured.module.mockmvc.RestAssuredMockMvc</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span>  <span class="class">MvcSpec</span> <span class="directive">extends</span> Specification {
  <span class="keyword">def</span> <span class="function">setup</span>() {
   RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> ExampleSpringController())
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of using <code>Explicit</code> mode, you can use base class to initialize the whole tested app similarly as in regular integration tests. In case of <code>JAXRSCLIENT</code> mode this base class should also contain <code>protected WebTarget webTarget</code> field, right now the only option to test JAX-RS API is to start a web server.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="invoking-generated-tests-2">Invoking generated tests</h4>
<div class="paragraph">
<p>Accurest Maven Plugins generates verification code into directory <code>/generated-test-sources/accurest</code> and attach this directory to <code>testCompile</code> goal.</p>
</div>
<div class="paragraph">
<p>For Groovy Spock code use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.codehaus.gmavenplus<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>gmavenplus-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.5<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;executions&gt;</span>
                <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;goals&gt;</span>
                                <span class="tag">&lt;goal&gt;</span>testCompile<span class="tag">&lt;/goal&gt;</span>
                        <span class="tag">&lt;/goals&gt;</span>
                <span class="tag">&lt;/execution&gt;</span>
        <span class="tag">&lt;/executions&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;testSources&gt;</span>
                        <span class="tag">&lt;testSource&gt;</span>
                                <span class="tag">&lt;directory&gt;</span>${project.basedir}/src/test/groovy<span class="tag">&lt;/directory&gt;</span>
                                <span class="tag">&lt;includes&gt;</span>
                                        <span class="tag">&lt;include&gt;</span>**/*.groovy<span class="tag">&lt;/include&gt;</span>
                                <span class="tag">&lt;/includes&gt;</span>
                        <span class="tag">&lt;/testSource&gt;</span>
                        <span class="tag">&lt;testSource&gt;</span>
                                <span class="tag">&lt;directory&gt;</span>${project.build.directory}/generated-test-sources/accurest<span class="tag">&lt;/directory&gt;</span>
                                <span class="tag">&lt;includes&gt;</span>
                                        <span class="tag">&lt;include&gt;</span>**/*.groovy<span class="tag">&lt;/include&gt;</span>
                                <span class="tag">&lt;/includes&gt;</span>
                        <span class="tag">&lt;/testSource&gt;</span>
                <span class="tag">&lt;/testSources&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To ensure that provider side is complaint with defined contracts, you need to invoke <code>mvn generateTest test</code></p>
</div>
</div>
<div class="sect3">
<h4 id="accurest-on-consumer-side-2">Accurest on consumer side</h4>
<div class="paragraph">
<p>In consumer service you need to configure Accurest plugin in exactly the same way as in case of provider. You need to copy contracts stored in <code>src/test/resources/accurest</code> and generate Wiremock json stubs using: <code>mvn generateStubs</code> command. By default generated WireMock mapping is stored in directory <code>target/mappings</code>. Your project should create from this generated mappings additional artifact with classifier <code>stubs</code> for easy deploy to maven repository.</p>
</div>
<div class="paragraph">
<p>Sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.codearte.accurest<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>accurest-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${accurest-plugin.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;executions&gt;</span>
        <span class="tag">&lt;execution&gt;</span>
            <span class="tag">&lt;goals&gt;</span>
                <span class="tag">&lt;goal&gt;</span>convert<span class="tag">&lt;/goal&gt;</span>
                <span class="tag">&lt;goal&gt;</span>generateStubs<span class="tag">&lt;/goal&gt;</span>
            <span class="tag">&lt;/goals&gt;</span>
        <span class="tag">&lt;/execution&gt;</span>
    <span class="tag">&lt;/executions&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When present, json stubs can be used in consumer automated tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ContextConfiguration</span>(loader == SpringApplicationContextLoader, classes == Application)
<span class="type">class</span> <span class="class">LoanApplicationServiceSpec</span> <span class="directive">extends</span> Specification {

 <span class="annotation">@ClassRule</span>
 <span class="annotation">@Shared</span>
 WireMockClassRule wireMockRule == <span class="keyword">new</span> WireMockClassRule()

 <span class="annotation">@Autowired</span>
 LoanApplicationService sut

 <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should successfully apply for loan</span><span class="delimiter">'</span></span>() {
   <span class="key">given</span>:
         LoanApplication application =
                        <span class="keyword">new</span> LoanApplication(<span class="key">client</span>: <span class="keyword">new</span> Client(<span class="key">pesel</span>: <span class="string"><span class="delimiter">'</span><span class="content">12345678901</span><span class="delimiter">'</span></span>), <span class="key">amount</span>: <span class="float">123.123</span>)
   <span class="key">when</span>:
        LoanApplicationResult loanApplication == sut.loanApplication(application)
   <span class="key">then</span>:
        loanApplication.loanApplicationStatus === LoanApplicationStatus.LOAN_APPLIED
        loanApplication.rejectionReason === <span class="predefined-constant">null</span>
 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Underneath LoanApplication makes a call to FraudDetection service. This request is handled by Wiremock server configured using stubs generated by Accurest.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scenarios">Scenarios</h3>
<div class="paragraph">
<p>It&#8217;s possible to handle scenarios with Accurest. All you need to do is to stick to proper naming convention while creating your contracts. The convention requires to include order number followed by the underscore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>my_contracts_dir\
  scenario1\
    1_login.groovy
    2_showCart.groovy
    3_logout.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Such tree will cause Accurest generating Wiremock&#8217;s scenario with name <code>scenario1</code> and three steps:
 - login marked as <code>Started</code> pointing to:
 - showCart marked as <code>Step1</code> pointing to:
 - logout marked as <code>Step2</code> which will close the scenario.
More details about Wiremock scenarios can be found under [<a href="http://wiremock.org/stateful-behaviour.html" class="bare">http://wiremock.org/stateful-behaviour.html</a>](<a href="http://wiremock.org/stateful-behaviour.html" class="bare">http://wiremock.org/stateful-behaviour.html</a>)</p>
</div>
<div class="paragraph">
<p>Accurest will also generate tests with guaranteed order of execution.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accurest-messaging">Accurest Messaging</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Feature available since 1.1.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Accurest allows you to verify your application that uses messaging as means of communication.
All of our integrations are working with Spring but you can also set one yourself.</p>
</div>
<div class="sect2">
<h3 id="integrations">Integrations</h3>
<div class="paragraph">
<p>You can use one of the three integration configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Camel</p>
</li>
<li>
<p>Spring Integration</p>
</li>
<li>
<p>Spring Cloud Stream</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re using Spring Boot, the aforementioned test configurations will be appended automatically.</p>
</div>
<div class="paragraph">
<p>You have to provide as a dependency one of the Accurest Messaging modules. Example for Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// for Apache Camel</span>
testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:accurest-messaging-camel:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
<span class="comment">// for Spring Integration</span>
testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:accurest-messaging-integration:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
<span class="comment">// for Spring Cloud Stream</span>
testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:accurest-messaging-stream:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manual-integration">Manual Integration</h3>
<div class="paragraph">
<p>The <code>accurest-messaging-core</code> module contains 3 main interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AccurestMessage</code> - describes a message received / sent to a channel / queue / topic etc.</p>
</li>
<li>
<p><code>AccurestMessageBuilder</code> - describes how to build a message</p>
</li>
<li>
<p><code>AccurestMessaging</code> - class that allows you to build, send and receive messages</p>
</li>
<li>
<p><code>AccurestFilter</code> - interface to filter out the messages that do not follow the pattern from the DSL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the generated test the <code>AccurestMessaging</code> is injected via <code>@Inject</code> annotation thus you can use other injection
frameworks than Spring.</p>
</div>
<div class="paragraph">
<p>You have to provide as a dependency the <code>accurest-messaging-core</code> module. Example for Gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:accurest-messaging-core:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="publisher-side-test-generation">Publisher side test generation</h3>
<div class="paragraph">
<p>Having the <code>input</code> or <code>outputMessage</code> sections in your DSL will result in creation of tests on the publisher&#8217;s side. By default
JUnit tests will be created, however there is also a possibility to create Spock tests.</p>
</div>
<div class="paragraph">
<p>There are 3 main scenarios that we should take into consideration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scenario 1: there is no input message that produces an output one. The output message is triggered by a component
inside the application (e.g. scheduler)</p>
</li>
<li>
<p>Scenario 2: the input message triggers an output message</p>
</li>
<li>
<p>Scenario 3: the input message is consumed and there is no output message</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="scenario-1-no-input-message">Scenario 1 (no input message)</h4>
<div class="paragraph">
<p>For the given contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> contractDsl = GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        input {
                triggeredBy(<span class="string"><span class="delimiter">'</span><span class="content">bookReturnedTriggered()</span><span class="delimiter">'</span></span>)
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">activemq:output</span><span class="delimiter">'</span></span>)
                body(<span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;bookName&quot; : &quot;foo&quot; }</span><span class="delimiter">'''</span></span>)
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following JUnit test will be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
 // when:
  bookReturnedTriggered();

 // then:
  AccurestMessage response = accurestMessaging.receiveMessage(&quot;activemq:output&quot;);
  assertThat(response).isNotNull();
  assertThat(response.getHeader(&quot;BOOK-NAME&quot;)).isEqualTo(&quot;foo&quot;);
 // and:
  DocumentContext parsedJson = JsonPath.parse(accurestObjectMapper.writeValueAsString(response.getPayload()));
  assertThatJson(parsedJson).field(&quot;bookName&quot;).isEqualTo(&quot;foo&quot;);
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following Spock test would be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
 when:
  bookReturnedTriggered()

 then:
  def response = accurestMessaging.receiveMessage('activemq:output')
  assert response != null
  response.getHeader('BOOK-NAME')  == 'foo'
 and:
  DocumentContext parsedJson = JsonPath.parse(accurestObjectMapper.writeValueAsString(response.payload))
  assertThatJson(parsedJson).field(&quot;bookName&quot;).isEqualTo(&quot;foo&quot;)

</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scenario-2-output-triggered-by-input">Scenario 2 (output triggered by input)</h4>
<div class="paragraph">
<p>For the given contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> contractDsl = GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        input {
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">jms:input</span><span class="delimiter">'</span></span>)
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>)
                body([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following JUnit test will be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
// given:
 AccurestMessage inputMessage = accurestMessaging.create(
  &quot;{</span><span class="char">\\</span><span class="content">&quot;bookName</span><span class="char">\\</span><span class="content">&quot;:</span><span class="char">\\</span><span class="content">&quot;foo</span><span class="char">\\</span><span class="content">&quot;}&quot;
, headers()
  .header(&quot;sample&quot;, &quot;header&quot;));

// when:
 accurestMessaging.send(inputMessage, &quot;jms:input&quot;);

// then:
 AccurestMessage response = accurestMessaging.receiveMessage(&quot;jms:output&quot;);
 assertThat(response).isNotNull();
 assertThat(response.getHeader(&quot;BOOK-NAME&quot;)).isEqualTo(&quot;foo&quot;);
// and:
 DocumentContext parsedJson = JsonPath.parse(accurestObjectMapper.writeValueAsString(response.getPayload()));
 assertThatJson(parsedJson).field(&quot;bookName&quot;).isEqualTo(&quot;foo&quot;);
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following Spock test would be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="char">\
</span><span class="content">given:
   def inputMessage = accurestMessaging.create(
    '''{&quot;bookName&quot;:&quot;foo&quot;}''',
    ['sample': 'header']
  )

when:
   accurestMessaging.send(inputMessage, 'jms:input')

then:
   def response = accurestMessaging.receiveMessage('jms:output')
   assert response !- null
   response.getHeader('BOOK-NAME')  == 'foo'
and:
   DocumentContext parsedJson = JsonPath.parse(accurestObjectMapper.writeValueAsString(response.payload))
   assertThatJson(parsedJson).field(&quot;bookName&quot;).isEqualTo(&quot;foo&quot;)
</span><span class="delimiter">&quot;&quot;&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scenario-3-no-output-message">Scenario 3 (no output message)</h4>
<div class="paragraph">
<p>For the given contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> contractDsl = GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">some_label</span><span class="delimiter">'</span></span>
        input {
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">jms:delete</span><span class="delimiter">'</span></span>)
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
                assertThat(<span class="string"><span class="delimiter">'</span><span class="content">bookWasDeleted()</span><span class="delimiter">'</span></span>)
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following JUnit test will be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
// given:
 AccurestMessage inputMessage = accurestMessaging.create(
        &quot;{</span><span class="char">\\</span><span class="content">&quot;bookName</span><span class="char">\\</span><span class="content">&quot;:</span><span class="char">\\</span><span class="content">&quot;foo</span><span class="char">\\</span><span class="content">&quot;}&quot;
, headers()
        .header(&quot;sample&quot;, &quot;header&quot;));

// when:
 accurestMessaging.send(inputMessage, &quot;jms:delete&quot;);

// then:
 bookWasDeleted();
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following Spock test would be created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'''</span><span class="content">
given:
         def inputMessage = accurestMessaging.create(
                </span><span class="char">\'</span><span class="char">\'</span><span class="char">\'</span><span class="content">{&quot;bookName&quot;:&quot;foo&quot;}</span><span class="char">\'</span><span class="char">\'</span><span class="char">\'</span><span class="content">,
                ['sample': 'header']
        )

when:
         accurestMessaging.send(inputMessage, 'jms:delete')

then:
         noExceptionThrown()
         bookWasDeleted()
</span><span class="delimiter">'''</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="consumer-stub-side-generation">Consumer Stub Side generation</h3>
<div class="paragraph">
<p>Unlike the HTTP part - in Messaging we need to publish the Groovy DSL inside the JAR with a stub. Then it&#8217;s parsed on the consumer side
and proper stubbed routes are created.</p>
</div>
<div class="paragraph">
<p>For more infromation please consult the Stub Runner Messaging sections.</p>
</div>
<div class="sect3">
<h4 id="gradle-setup">Gradle Setup</h4>
<div class="paragraph">
<p>Example of Accurest Gradle setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
        contractsDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>)
        stubsOutputDirRoot = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.buildDir<span class="inline-delimiter">}</span></span><span class="content">/production/</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="content">-stubs/</span><span class="delimiter">&quot;</span></span>)
        wireMockStubsOutputDir = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(stubsOutputDirRoot, <span class="string"><span class="delimiter">'</span><span class="content">repository/mappings/</span><span class="delimiter">'</span></span>))
        contractsOutputDir = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(stubsOutputDirRoot, <span class="string"><span class="delimiter">'</span><span class="content">repository/accurest/</span><span class="delimiter">'</span></span>))
}

task copyContracts(<span class="key">type</span>: Copy) {
        from contractsDir
        include <span class="string"><span class="delimiter">'</span><span class="content">**/*.groovy</span><span class="delimiter">'</span></span>
        into contractsOutputDir
}

task stubsJar(<span class="key">type</span>: Jar, <span class="key">dependsOn</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">generateWireMockClientStubs</span><span class="delimiter">&quot;</span></span>, copyContracts]) {
        baseName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        classifier = <span class="string"><span class="delimiter">&quot;</span><span class="content">stubs</span><span class="delimiter">&quot;</span></span>
        from stubsOutputDirRoot
}

artifacts {
        archives stubsJar
}

publishing {
        publications {
                stubs(MavenPublication) {
                        artifactId <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="content">-stubs</span><span class="delimiter">&quot;</span></span>
                        artifact stubsJar
                }
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="maven-setup">Maven Setup</h4>
<div class="paragraph">
<p>Example of Maven can be found in the <a href="https://github.com/Codearte/accurest-maven-plugin/=publishing-wiremock-stubs-projectf-stubsjar">Accurest Maven Plugin README</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stub-runner">Stub Runner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the issues that you could have encountered while using Accurest was to pass the generated WireMock JSON stubs from the server side to the client side (or various clients).
 The same takes place in terms of client side generation for messaging.</p>
</div>
<div class="paragraph">
<p>Copying the JSON files / setting the client side for messaging manually is out of the question.</p>
</div>
<div class="sect2">
<h3 id="publishing-stubs-as-jars">Publishing stubs as JARs</h3>
<div class="paragraph">
<p>The easiest approach would be to centralize the way stubs are kept. For example you can keep them as JARs in a Maven repository.</p>
</div>
<div class="sect3">
<h4 id="gradle">Gradle</h4>
<div class="paragraph">
<p>Example of Accurest Gradle setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext {
        contractsDir = file(<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span>)
        stubsOutputDirRoot = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.buildDir<span class="inline-delimiter">}</span></span><span class="content">/production/</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="content">-stubs/</span><span class="delimiter">&quot;</span></span>)
        wireMockStubsOutputDir = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(stubsOutputDirRoot, <span class="string"><span class="delimiter">'</span><span class="content">repository/mappings/</span><span class="delimiter">'</span></span>))
        contractsOutputDir = file(<span class="keyword">new</span> <span class="predefined-type">File</span>(stubsOutputDirRoot, <span class="string"><span class="delimiter">'</span><span class="content">repository/accurest/</span><span class="delimiter">'</span></span>))
}

task copyContracts(<span class="key">type</span>: Copy) {
        from contractsDir
        include <span class="string"><span class="delimiter">'</span><span class="content">**/*.groovy</span><span class="delimiter">'</span></span>
        into contractsOutputDir
}

task stubsJar(<span class="key">type</span>: Jar, <span class="key">dependsOn</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">generateWireMockClientStubs</span><span class="delimiter">&quot;</span></span>, copyContracts]) {
        baseName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        classifier = <span class="string"><span class="delimiter">&quot;</span><span class="content">stubs</span><span class="delimiter">&quot;</span></span>
        from stubsOutputDirRoot
}

artifacts {
        archives stubsJar
}

publishing {
        publications {
                stubs(MavenPublication) {
                        artifactId <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>project.name<span class="inline-delimiter">}</span></span><span class="content">-stubs</span><span class="delimiter">&quot;</span></span>
                        artifact stubsJar
                }
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="maven">Maven</h4>
<div class="paragraph">
<p>Example of Maven can be found in the <a href="https://github.com/Codearte/accurest-maven-plugin/=publishing-wiremock-stubs-projectf-stubsjar">Accurest Maven Plugin README</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modules">Modules</h3>
<div class="paragraph">
<p>Accurest comes with a new structure of modules</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>└── stub-runner
    ├── stub-runner
    ├── stub-runner-boot
    ├── stub-runner-junit
    ├── stub-runner-spring
    └── stub-runner-spring-cloud</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-core">Stub Runner Core</h3>
<div class="paragraph">
<p>Runs stubs for service collaborators. Treating stubs as contracts of services allows to use stub-runner as an implementation of
<a href="http://martinfowler.com/articles/consumerDrivenContracts.html">Consumer Driven Contracts</a>.</p>
</div>
<div class="paragraph">
<p>Stub Runner allows you to automatically download the stubs of the provided dependencies, start WireMock servers for them and feed them with proper stub definitions.
For messaging, special stub routes are defined.</p>
</div>
<div class="sect3">
<h4 id="running-stubs">Running stubs</h4>
<div class="sect4">
<h5 id="running-using-main-app">Running using main app</h5>
<div class="paragraph">
<p>You can set the following options to the main class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">-maxp (--maxPort) N            : Maximum port value to be assigned to the
                                 Wiremock instance. Defaults to <span class="integer">15000</span>
                                 (<span class="keyword">default</span>: <span class="integer">15000</span>)
-minp (--minPort) N            : Minimal port value to be assigned to the
                                 Wiremock instance. Defaults to <span class="integer">10000</span>
                                 (<span class="keyword">default</span>: <span class="integer">10000</span>)
-s (--stubs) VAL               : Comma separated list of Ivy representation of
                                 jars with stubs. Eg. groupid:artifactid1,group
                                 <span class="key">id2</span>:<span class="key">artifactid2</span>:<span class="key">version</span>:classifier
-sr (--stubRepositoryRoot) VAL : Location of a Jar containing server where you
                                 keep your stubs (e.g. http:<span class="comment">//nexus.net/content</span>
                                 <span class="regexp"><span class="delimiter">/</span><span class="content">repositories</span><span class="delimiter">/</span></span>repository)
-ss (--stubsSuffix) VAL        : Suffix <span class="keyword">for</span> the jar containing stubs (e.g.
                                 <span class="string"><span class="delimiter">'</span><span class="content">stubs</span><span class="delimiter">'</span></span> <span class="keyword">if</span> the stub jar would have a <span class="string"><span class="delimiter">'</span><span class="content">stubs</span><span class="delimiter">'</span></span>
                                 classifier <span class="keyword">for</span> <span class="key">stubs</span>: foobar-stubs ).
                                 Defaults to <span class="string"><span class="delimiter">'</span><span class="content">stubs</span><span class="delimiter">'</span></span> (<span class="keyword">default</span>: stubs)
-wo (--workOffline)            : Switch to work offline. Defaults to <span class="string"><span class="delimiter">'</span><span class="content">false</span><span class="delimiter">'</span></span>
                                 (<span class="keyword">default</span>: <span class="predefined-constant">false</span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="building-a-fat-jar">Building a Fat Jar</h5>
<div class="paragraph">
<p>Just call the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew stub-runner-root:stub-runner:shadowJar -PfatJar</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and inside the <code>build/lib</code> there will be a Fat Jar with classifier <code>fatJar</code> waiting for you to execute. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java -jar stub-runner/stub-runner/build/libs/stub-runner-<span class="float">1.0</span><span class="float">.1</span>-SNAPSHOT-fatJar.jar -sr <span class="key">http</span>:<span class="comment">//a.b.com -s a:b:c,d:e,f:g:h:i</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stub-runner-configuration">Stub runner configuration</h4>
<div class="paragraph">
<p>You can configure the stub runner by either passing the full arguments list with the <code>-Pargs</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew stub-runner-root:stub-runner:run -Pargs=&quot;-c pl -minp 10000 -maxp 10005 -s a:b:c,d:e,f:g:h&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or each parameter separately with a <code>-P</code> prefix and without the hyphen <code>-</code> in the name of the param</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew stub-runner-root:stub-runner:run -Pc=pl -Pminp=10000 -Pmaxp=10005 -Ps=a:b:c,d:e,f:g:h</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="http-stubs">HTTP Stubs</h5>
<div class="paragraph">
<p>Stubs are defined in JSON documents, whose syntax is defined in <a href="http://wiremock.org/stubbing.html">WireMock documentation</a></p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">request</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">method</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/ping</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="integer">200</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">pong</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">headers</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="viewing-registered-mappings">Viewing registered mappings</h5>
<div class="paragraph">
<p>Every stubbed collaborator exposes list of defined mappings under <code>__/admin/</code> endpoint.</p>
</div>
</div>
<div class="sect4">
<h5 id="messaging-stubs">Messaging Stubs</h5>
<div class="paragraph">
<p>Depending on the provided Stub Runner dependency and the DSL the messaging routes are automatically set up.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-boot">Stub Runner Boot</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Feature available since 1.1.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Accurest Stub Runner Boot is a Spring Boot application that exposes REST endpoints to
trigger the messaging labels and to access started WireMock servers.</p>
</div>
<div class="paragraph">
<p>One of the usecases is to run some smoke (end to end) tests on a deployed application. You can read
 more about this in the  <a href="http://toomuchcoding.com/blog/2015/09/27/microservice-deployment/">"Microservice Deployment" article at Too Much Coding blog.</a></p>
</div>
<div class="sect3">
<h4 id="how-to-use-it">How to use it?</h4>
<div class="paragraph">
<p>Just add the</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-boot:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and a messaging implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// for Apache Camel</span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-camel:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
<span class="comment">// for Spring Integration</span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-integration:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
<span class="comment">// for Spring Cloud Stream</span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-stream:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Build a fat-jar and you&#8217;re ready to go!</p>
</div>
<div class="paragraph">
<p>For the properties check the <strong>Stub Runner Spring</strong> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="endpoints">Endpoints</h4>
<div class="sect4">
<h5 id="http">HTTP</h5>
<div class="ulist">
<ul>
<li>
<p>GET <code>/stubs</code> - returns a list of all running stubs in <code>ivy:integer</code> notation</p>
</li>
<li>
<p>GET <code>/stubs/{ivy}</code> - returns a port for the given <code>ivy</code> notation (when calling the endpoint <code>ivy</code> can also be <code>artifactId</code> only)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="messaging">Messaging</h5>
<div class="paragraph">
<p>For Messaging</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET <code>/triggers</code> - returns a list of all running labels in <code>ivy : [ label1, label2 &#8230;&#8203;]</code> notation</p>
</li>
<li>
<p>POST <code>/triggers/{label}</code> - executes a trigger with <code>label</code></p>
</li>
<li>
<p>POST <code>/triggers/{ivy}/{label}</code> - executes a trigger with <code>label</code> for the given <code>ivy</code> notation (when calling the endpoint <code>ivy</code> can also be <code>artifactId</code> only)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example">Example</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ContextConfiguration</span>(classes = [StubRunnerBootSpec, StubRunnerBoot], loader = SpringApplicationContextLoader)
<span class="annotation">@EnableBinding</span>
<span class="annotation">@Configuration</span>
<span class="type">class</span> <span class="class">StubRunnerBootSpec</span> <span class="directive">extends</span> Specification {

        <span class="annotation">@Autowired</span> StubRunning stubRunning

        <span class="keyword">def</span> <span class="function">setup</span>() {
                RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> HttpStubsController(stubRunning),
                                <span class="keyword">new</span> TriggerController(stubRunning))
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should return a list of running stub servers in &quot;full ivy:port&quot; notation</span><span class="delimiter">'</span></span>() {
                <span class="key">when</span>:
                        <span class="predefined-type">String</span> response = RestAssuredMockMvc.get(<span class="string"><span class="delimiter">'</span><span class="content">/stubs</span><span class="delimiter">'</span></span>).body.asString()
                <span class="key">then</span>:
                        <span class="keyword">def</span> root = <span class="keyword">new</span> JsonSlurper().parseText(response)
                        root.<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:0.0.1-SNAPSHOT:stubs</span><span class="delimiter">'</span></span> <span class="keyword">instanceof</span> <span class="predefined-type">Integer</span>
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should return a port on which a [#stubId] stub is running</span><span class="delimiter">'</span></span>() {
                <span class="key">when</span>:
                        <span class="keyword">def</span> response = RestAssuredMockMvc.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/stubs/</span><span class="inline"><span class="inline-delimiter">${</span>stubId<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                <span class="key">then</span>:
                        response.statusCode == <span class="integer">200</span>
                        response.body.as(<span class="predefined-type">Integer</span>) &gt; <span class="integer">0</span>
                <span class="key">where</span>:
                        stubId &lt;&lt; [<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:+:stubs</span><span class="delimiter">'</span></span>,
                                           <span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:0.0.1-SNAPSHOT:stubs</span><span class="delimiter">'</span></span>,
                                           <span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:+</span><span class="delimiter">'</span></span>,
                                           <span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService</span><span class="delimiter">'</span></span>,
                                           <span class="string"><span class="delimiter">'</span><span class="content">streamService</span><span class="delimiter">'</span></span>]
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should return 404 when missing stub was called</span><span class="delimiter">'</span></span>() {
                <span class="key">when</span>:
                        <span class="keyword">def</span> response = RestAssuredMockMvc.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/stubs/a:b:c:d</span><span class="delimiter">&quot;</span></span>)
                <span class="key">then</span>:
                        response.statusCode == <span class="integer">404</span>
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should return a list of messaging labels that can be triggered when version and classifier are passed</span><span class="delimiter">'</span></span>() {
                <span class="key">when</span>:
                        <span class="predefined-type">String</span> response = RestAssuredMockMvc.get(<span class="string"><span class="delimiter">'</span><span class="content">/triggers</span><span class="delimiter">'</span></span>).body.asString()
                <span class="key">then</span>:
                        <span class="keyword">def</span> root = <span class="keyword">new</span> JsonSlurper().parseText(response)
                        root.<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:0.0.1-SNAPSHOT:stubs</span><span class="delimiter">'</span></span>?.containsAll([<span class="string"><span class="delimiter">&quot;</span><span class="content">delete_book</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">return_book_1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">return_book_2</span><span class="delimiter">&quot;</span></span>])
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should trigger a messaging label</span><span class="delimiter">'</span></span>() {
                <span class="key">given</span>:
                        StubRunning stubRunning = Mock()
                        RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> HttpStubsController(stubRunning), <span class="keyword">new</span> TriggerController(stubRunning))
                <span class="key">when</span>:
                        <span class="keyword">def</span> response = RestAssuredMockMvc.post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/triggers/delete_book</span><span class="delimiter">&quot;</span></span>)
                <span class="key">then</span>:
                        response.statusCode == <span class="integer">200</span>
                <span class="key">and</span>:
                        <span class="integer">1</span> * stubRunning.trigger(<span class="string"><span class="delimiter">'</span><span class="content">delete_book</span><span class="delimiter">'</span></span>)
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should trigger a messaging label for a stub with [#stubId] ivy notation</span><span class="delimiter">'</span></span>() {
                <span class="key">given</span>:
                        StubRunning stubRunning = Mock()
                        RestAssuredMockMvc.standaloneSetup(<span class="keyword">new</span> HttpStubsController(stubRunning), <span class="keyword">new</span> TriggerController(stubRunning))
                <span class="key">when</span>:
                        <span class="keyword">def</span> response = RestAssuredMockMvc.post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/triggers/</span><span class="inline"><span class="inline-delimiter">$</span>stubId</span><span class="content">/delete_book</span><span class="delimiter">&quot;</span></span>)
                <span class="key">then</span>:
                        response.statusCode == <span class="integer">200</span>
                <span class="key">and</span>:
                        <span class="integer">1</span> * stubRunning.trigger(stubId, <span class="string"><span class="delimiter">'</span><span class="content">delete_book</span><span class="delimiter">'</span></span>)
                <span class="key">where</span>:
                        stubId &lt;&lt; [<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">streamService</span><span class="delimiter">'</span></span>]
        }

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should return when trigger is missing</span><span class="delimiter">'</span></span>() {
                <span class="key">when</span>:
                        <span class="keyword">def</span> response = RestAssuredMockMvc.post(<span class="string"><span class="delimiter">&quot;</span><span class="content">/triggers/missing_label</span><span class="delimiter">&quot;</span></span>)
                <span class="key">then</span>:
                        response.statusCode == <span class="integer">404</span>
                        <span class="keyword">def</span> root = <span class="keyword">new</span> JsonSlurper().parseText(response.body.asString())
                        root.<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:streamService:0.0.1-SNAPSHOT:stubs</span><span class="delimiter">'</span></span>?.containsAll([<span class="string"><span class="delimiter">&quot;</span><span class="content">delete_book</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">return_book_1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">return_book_2</span><span class="delimiter">&quot;</span></span>])
        }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-junit-rule">Stub Runner JUnit Rule</h3>
<div class="paragraph">
<p>Stub Runner comes with a JUnit rule thanks to which you can very easily download and run stubs for given group and artifact id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClassRule</span> <span class="directive">public</span> <span class="directive">static</span> AccurestRule rule = <span class="keyword">new</span> AccurestRule()
                .repoRoot(repoRoot())
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that rule gets executed Stub Runner connects to your Maven repository and for the given list of dependencies tries to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>download them</p>
</li>
<li>
<p>cache them locally</p>
</li>
<li>
<p>unzip them to a temporary folder</p>
</li>
<li>
<p>start a WireMock server for each Maven dependency on a random port from the provided range of ports / provided port</p>
</li>
<li>
<p>feed the WireMock server with all JSON files that are valid WireMock definitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stub Runner uses <a href="https://wiki.eclipse.org/Aether">Eclipse Aether</a> mechanism to download the Maven dependencies.
Check their <a href="https://wiki.eclipse.org/Aether">docs</a> for more information.</p>
</div>
<div class="paragraph">
<p>Since the <code>AccurestRule</code> implements the <code>StubFinder</code> it allows you to find the started stubs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> io.codearte.accurest.stubrunner

<span class="keyword">import</span> <span class="include">io.codearte.accurest.dsl.GroovyDsl</span>

<span class="type">interface</span> StubFinder <span class="directive">extends</span> StubTrigger {
        <span class="comment">/**
         * For the given groupId and artifactId tries to find the matching
         * URL of the running stub.
         *
         * @param groupId - might be null. In that case a search only via artifactId takes place
         * @return URL of a running stub or null if not found
         */</span>
        <span class="predefined-type">URL</span> findStubUrl(<span class="predefined-type">String</span> groupId, <span class="predefined-type">String</span> artifactId)

        <span class="comment">/**
         * For the given Ivy notation {@code groupId:artifactId} tries to find the matching
         * URL of the running stub. You can also pass only {@code artifactId}.
         *
         * @param ivyNotation - Ivy representation of the Maven artifact
         * @return URL of a running stub or null if not found
         */</span>
        <span class="predefined-type">URL</span> findStubUrl(<span class="predefined-type">String</span> ivyNotation)

        <span class="comment">/**
         * Returns all running stubs
         */</span>
        RunningStubs findAllRunningStubs()

        <span class="comment">/**
         * Returns the list of Accurest contracts
         */</span>
        <span class="predefined-type">Map</span>&lt;StubConfiguration, <span class="predefined-type">Collection</span>&lt;GroovyDsl&gt;&gt; getAccurestContracts()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of usage in Spock tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ClassRule</span> <span class="annotation">@Shared</span> AccurestRule rule = <span class="keyword">new</span> AccurestRule()
                .repoRoot(AccurestRuleSpec.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/m2repo</span><span class="delimiter">&quot;</span></span>).toURI().toString())
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should start WireMock servers</span><span class="delimiter">'</span></span>() {
        <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">WireMocks are running</span><span class="delimiter">'</span></span>
                rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
                rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
                rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) == rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>)
                rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
        <span class="key">and</span>:
                rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>)
                rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>)
                rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">'</span></span>)
        <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">Stubs were registered</span><span class="delimiter">'</span></span>
                <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>).toString()<span class="inline-delimiter">}</span></span><span class="content">/name</span><span class="delimiter">&quot;</span></span>.toURL().text == <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>
                <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>rule.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>).toString()<span class="inline-delimiter">}</span></span><span class="content">/name</span><span class="delimiter">&quot;</span></span>.toURL().text == <span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example of usage in JUnit tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> should_start_wiremock_servers() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// expect: 'WireMocks are running'</span>
                then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)).isNotNull();
                then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)).isNotNull();
                then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)).isEqualTo(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>));
                then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">&quot;</span></span>)).isNotNull();
        <span class="comment">// and:</span>
                then(rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)).isTrue();
                then(rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fraudDetectionServer</span><span class="delimiter">&quot;</span></span>)).isTrue();
                then(rule.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">&quot;</span></span>)).isTrue();
        <span class="comment">// and: 'Stubs were registered'</span>
                then(httpGet(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>).toString() + <span class="string"><span class="delimiter">&quot;</span><span class="content">/name</span><span class="delimiter">&quot;</span></span>)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>);
                then(httpGet(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">fraudDetectionServer</span><span class="delimiter">&quot;</span></span>).toString() + <span class="string"><span class="delimiter">&quot;</span><span class="content">/name</span><span class="delimiter">&quot;</span></span>)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">fraudDetectionServer</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the <strong>Common properties for JUnit and Spring</strong> for more information on how to apply global configuration of Stub Runner.</p>
</div>
<div class="sect3">
<h4 id="providing-fixed-ports">Providing fixed ports</h4>
<div class="paragraph">
<p>You can also run your stubs on fixed ports. You can do it in two different ways. One is to pass it in the properties, and the other via fluent API of
JUnit rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="fluent-api">Fluent API</h4>
<div class="paragraph">
<p>When using the <code>AccurestRule</code> you can add a stub to download and then pass the port for the last downloaded stub.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClassRule</span> <span class="directive">public</span> <span class="directive">static</span> AccurestRule rule = <span class="keyword">new</span> AccurestRule()
                .repoRoot(repoRoot())
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)
                .withPort(<span class="integer">12345</span>)
                .downloadStub(<span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer:12346</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that for this example the following test is valid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">loanIssuance</span><span class="delimiter">&quot;</span></span>)).isEqualTo(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:12345</span><span class="delimiter">&quot;</span></span>).toURL());
then(rule.findStubUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">fraudDetectionServer</span><span class="delimiter">&quot;</span></span>)).isEqualTo(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:12346</span><span class="delimiter">&quot;</span></span>).toURL());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-spring">Stub Runner Spring</h3>
<div class="paragraph">
<p>Sets up Spring configuration of the Stub Runner project.</p>
</div>
<div class="paragraph">
<p>By providing a list of stubs inside your configuration file the Stub Runner automatically downloads
and registers in WireMock the selected stubs.</p>
</div>
<div class="paragraph">
<p>If you want to find the URL of your stubbed dependency you can autowire the <code>StubFinder</code> interface and use
its methods as presented below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@ContextConfiguration</span>(classes = Config, loader = SpringApplicationContextLoader)
<span class="type">class</span> <span class="class">StubRunnerConfigurationSpec</span> <span class="directive">extends</span> Specification {

        <span class="annotation">@Autowired</span> StubFinder stubFinder

        <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">should start WireMock servers</span><span class="delimiter">'</span></span>() {
                <span class="key">expect</span>: <span class="string"><span class="delimiter">'</span><span class="content">WireMocks are running</span><span class="delimiter">'</span></span>
                        stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
                        stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
                        stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>) == stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>)
                        stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">'</span></span>) != <span class="predefined-constant">null</span>
                <span class="key">and</span>:
                        stubFinder.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>)
                        stubFinder.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>)
                        stubFinder.findAllRunningStubs().isPresent(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:fraudDetectionServer</span><span class="delimiter">'</span></span>)
                <span class="key">and</span>: <span class="string"><span class="delimiter">'</span><span class="content">Stubs were registered</span><span class="delimiter">'</span></span>
                        <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>).toString()<span class="inline-delimiter">}</span></span><span class="content">/name</span><span class="delimiter">&quot;</span></span>.toURL().text == <span class="string"><span class="delimiter">'</span><span class="content">loanIssuance</span><span class="delimiter">'</span></span>
                        <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>stubFinder.findStubUrl(<span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>).toString()<span class="inline-delimiter">}</span></span><span class="content">/name</span><span class="delimiter">&quot;</span></span>.toURL().text == <span class="string"><span class="delimiter">'</span><span class="content">fraudDetectionServer</span><span class="delimiter">'</span></span>
        }

        <span class="annotation">@Configuration</span>
        <span class="annotation">@Import</span>(StubRunnerConfiguration)
        <span class="annotation">@EnableAutoConfiguration</span>
        <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>for the following configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">stubrunner.stubs.repository.root</span>: <span class="string"><span class="content">classpath:m2repo/repository/</span></span>
<span class="key">stubrunner.stubs.ids</span>: <span class="string"><span class="content">io.codearte.accurest.stubs:loanIssuance,io.codearte.accurest.stubs:fraudDetectionServer</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-spring-cloud">Stub Runner Spring Cloud</h3>
<div class="paragraph">
<p>Registers the stubs in the provided Service Discovery. It&#8217;s enough to add the jar</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest:stub-runner-spring-cloud</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the Stub Runner autoconfiguration should be picked up.</p>
</div>
<div class="sect3">
<h4 id="stubbing-service-discovery">Stubbing Service Discovery</h4>
<div class="paragraph">
<p>The most important feature of <code>Stub Runner Spring Cloud</code> is the fact that it&#8217;s stubbing</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiscoveryClient</code></p>
</li>
<li>
<p><code>Ribbon</code> <code>ServerList</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>that means that regardles of the fact whether you&#8217;re using Zookeeper, Consul, Eureka or anything else, you don&#8217;t need that in your tests.
We&#8217;re starting WireMock instances of your dependencies and we&#8217;re telling your application whenever you&#8217;re using <code>Feign</code>, load balanced <code>RestTemplate</code>
or <code>DiscoveryClient</code> directly, to call those stubbed servers instead of calling the real Service Discovery tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional-configuration">Additional Configuration</h4>
<div class="paragraph">
<p>You can match the artifactId of the stub with the name of your app by using the <code>stubrunner.stubs.idsToServiceIds:</code> map.
You can disable Stub Runner Ribbon support by providing: <code>stubrunner.cloud.ribbon.enabled</code> equal to <code>false</code>
You can disable Stub Runner support by providing: <code>stubrunner.cloud.enabled</code> equal to <code>false</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="common-properties-for-junit-and-spring">Common properties for JUnit and Spring</h3>
<div class="paragraph">
<p>Some of the properties that are repetitive can be set using system properties or property sources (for Spring). Here are their names with their default values:</p>
</div>
<table class="tableblock frame-topbot grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.port.range.min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimal value of a port for a started WireMock with stubs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.port.range.max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimal value of a port for a started WireMock with stubs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stubs.repository.root</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of Maven repo urls. If blank then will call the local maven repo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stubs.classifier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default classifier for the stub artifacts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.work-offline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true then will not contact any remote repositories to download stubs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubrunner.stubs.ids</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of Ivy notation of stubs to download</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="stub-runner-stubs-ids">Stub runner stubs ids</h4>
<div class="paragraph">
<p>You can provide the stubs to download via the <code>stubrunner.stubs.ids</code> system property. They follow the following pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">groupId:artifactId:version:classifier:port</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>version</code>, <code>classifier</code> and <code>port</code> are optional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you don&#8217;t provide the <code>port</code> then a random one will be picked</p>
</li>
<li>
<p>If you don&#8217;t provide the <code>classifier</code> then the default one will be taken.</p>
</li>
<li>
<p>If you don&#8217;t provide the <code>version</code> then the <code>+</code> will be passed and the latest one will be downloaded</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>port</code> means the port of the WireMock server.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stub-runner-for-messaging">Stub Runner for Messaging</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Feature available since 1.1.0
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Stub Runner has the functionality to run the published stubs in memory. It can integrate with the following frameworks out of the box</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Integration</p>
</li>
<li>
<p>Spring Cloud Stream</p>
</li>
<li>
<p>Apache Camel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also provides points of entry to integrate with any other solution on the market.</p>
</div>
<div class="sect2">
<h3 id="stub-triggering">Stub triggering</h3>
<div class="paragraph">
<p>To trigger a message it&#8217;s enough to use the <code>StubTigger</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> io.codearte.accurest.stubrunner

<span class="type">interface</span> StubTrigger {

        <span class="comment">/**
         * Triggers an event by a given label for a given {@code groupid:artifactid} notation. You can use only {@code artifactId} too.
         *
         * Feature related to messaging.
         *
         * @return true - if managed to run a trigger
         */</span>
        <span class="type">boolean</span> trigger(<span class="predefined-type">String</span> ivyNotation, <span class="predefined-type">String</span> labelName)

        <span class="comment">/**
         * Triggers an event by a given label.
         *
         * Feature related to messaging.
         *
         * @return true - if managed to run a trigger
         */</span>
        <span class="type">boolean</span> trigger(<span class="predefined-type">String</span> labelName)

        <span class="comment">/**
         * Triggers all possible events.
         *
         * Feature related to messaging.
         *
         * @return true - if managed to run a trigger
         */</span>
        <span class="type">boolean</span> trigger()

        <span class="comment">/**
         * Returns a mapping of ivy notation of a dependency to all the labels it has.
         *
         * Feature related to messaging.
         */</span>
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt;&gt; labels()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For convenience the <code>StubFinder</code> interface extends <code>StubTrigger</code> so it&#8217;s enough to use only one in your tests.</p>
</div>
<div class="paragraph">
<p><code>StubTrigger</code> gives you the following options to trigger a message:</p>
</div>
<div class="sect3">
<h4 id="trigger-by-label">Trigger by label</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="trigger-by-group-and-artifact-ids">Trigger by group and artifact ids</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">io.codearte.accurest.stubs:camelService</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trigger-by-artifact-ids">Trigger by artifact ids</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">camelService</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="trigger-all-messages">Trigger all messages</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-messaging-camel">Stub Runner Messaging Camel</h3>
<div class="paragraph">
<p>Accurest Stub Runner&#8217;s messaging module gives you an easy way to integrate with Apache Camel.
For the provided artifacts it will automatically download the stubs and register the required
routes.</p>
</div>
<div class="sect3">
<h4 id="adding-it-to-the-project">Adding it to the project</h4>
<div class="paragraph">
<p>To use it you have to add the following dependency to your project (example for Gradle):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-camel:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examples">Examples</h4>
<div class="sect4">
<h5 id="stubs-structure">Stubs structure</h5>
<div class="paragraph">
<p>Let us assume that we have the following Maven repository with a deployed stubs for the
<code>camelService</code> application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">└── .m2
    └── repository
        └── io
            └── codearte
                └── accurest
                    └── stubs
                        └── camelService
                            ├── 0.0.1-SNAPSHOT
                            │   ├── camelService-0.0.1-SNAPSHOT.pom
                            │   ├── camelService-0.0.1-SNAPSHOT-stubs.jar
                            │   └── maven-metadata-local.xml
                            └── maven-metadata-local.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the stubs contain the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">├── META-INF
│   └── MANIFEST.MF
└── repository
    ├── accurest
    │   ├── bookDeleted.groovy
    │   ├── bookReturned1.groovy
    │   └── bookReturned2.groovy
    └── mappings</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following contracts (let' number it with <strong>1</strong>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>
        input {
                triggeredBy(<span class="string"><span class="delimiter">'</span><span class="content">bookReturnedTriggered()</span><span class="delimiter">'</span></span>)
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>)
                body(<span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;bookName&quot; : &quot;foo&quot; }</span><span class="delimiter">'''</span></span>)
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and number <strong>2</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_2</span><span class="delimiter">'</span></span>
        input {
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">jms:input</span><span class="delimiter">'</span></span>)
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>)
                body([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-1-no-input-message-2">Scenario 1 (no input message)</h5>
<div class="paragraph">
<p>So as to trigger a message via the <code>return_book_1</code> label we&#8217;ll use the <code>StubTigger</code> interface as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to <code>jms:output</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Exchange receivedMessage = camelContext.createConsumerTemplate().receive(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>, <span class="integer">5000</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertThatBodyContainsBookNameFoo(receivedMessage.in.body)
receivedMessage.in.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-2-output-triggered-by-input-2">Scenario 2 (output triggered by input)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>jms:output</code> destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">camelContext.createProducerTemplate().sendBodyAndHeaders(<span class="string"><span class="delimiter">'</span><span class="content">jms:input</span><span class="delimiter">'</span></span>, <span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to <code>jms:output</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Exchange receivedMessage = camelContext.createConsumerTemplate().receive(<span class="string"><span class="delimiter">'</span><span class="content">jms:output</span><span class="delimiter">'</span></span>, <span class="integer">5000</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertThatBodyContainsBookNameFoo(receivedMessage.in.body)
receivedMessage.in.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-3-input-with-no-output">Scenario 3 (input with no output)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>jms:output</code> destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">camelContext.createProducerTemplate().sendBodyAndHeaders(<span class="string"><span class="delimiter">'</span><span class="content">jms:delete</span><span class="delimiter">'</span></span>, <span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-messaging-integration">Stub Runner Messaging Integration</h3>
<div class="paragraph">
<p>Accurest Stub Runner&#8217;s messaging module gives you an easy way to integrate with Spring Integration.
For the provided artifacts it will automatically download the stubs and register the required
routes.</p>
</div>
<div class="sect3">
<h4 id="adding-it-to-the-project-2">Adding it to the project</h4>
<div class="paragraph">
<p>To use it you have to add the following dependency to your project (example for Gradle):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-integration:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examples-2">Examples</h4>
<div class="sect4">
<h5 id="stubs-structure-2">Stubs structure</h5>
<div class="paragraph">
<p>Let us assume that we have the following Maven repository with a deployed stubs for the
<code>integrationService</code> application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">└── .m2
    └── repository
        └── io
            └── codearte
                └── accurest
                    └── stubs
                        └── integrationService
                            ├── 0.0.1-SNAPSHOT
                            │   ├── integrationService-0.0.1-SNAPSHOT.pom
                            │   ├── integrationService-0.0.1-SNAPSHOT-stubs.jar
                            │   └── maven-metadata-local.xml
                            └── maven-metadata-local.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the stubs contain the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">├── META-INF
│   └── MANIFEST.MF
└── repository
    ├── accurest
    │   ├── bookDeleted.groovy
    │   ├── bookReturned1.groovy
    │   └── bookReturned2.groovy
    └── mappings</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following contracts (let' number it with <strong>1</strong>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>
        input {
                triggeredBy(<span class="string"><span class="delimiter">'</span><span class="content">bookReturnedTriggered()</span><span class="delimiter">'</span></span>)
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
                body(<span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;bookName&quot; : &quot;foo&quot; }</span><span class="delimiter">'''</span></span>)
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and number <strong>2</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_2</span><span class="delimiter">'</span></span>
        input {
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">input</span><span class="delimiter">'</span></span>)
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
                body([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following Spring Integration Route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/integration</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">xmlns:beans</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
                        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
                        <span class="content">http://www.springframework.org/schema/integration</span>
                        <span class="content">http://www.springframework.org/schema/integration/spring-integration.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>


        <span class="comment">&lt;!-- REQUIRED FOR TESTING --&gt;</span>
        <span class="tag">&lt;bridge</span> <span class="attribute-name">input-channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">output-channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputTest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;queue</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/channel&gt;</span>

<span class="tag">&lt;/beans:beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-1-no-input-message-3">Scenario 1 (no input message)</h5>
<div class="paragraph">
<p>So as to trigger a message via the <code>return_book_1</code> label we&#8217;ll use the <code>StubTigger</code> interface as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to <code>output</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AccurestMessage receivedMessage = messaging.receiveMessage(<span class="string"><span class="delimiter">'</span><span class="content">outputTest</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertJsons(receivedMessage.payload)
receivedMessage.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-2-output-triggered-by-input-3">Scenario 2 (output triggered by input)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>output</code> destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">messaging.send(<span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">input</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to <code>output</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AccurestMessage receivedMessage = messaging.receiveMessage(<span class="string"><span class="delimiter">'</span><span class="content">outputTest</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertJsons(receivedMessage.payload)
receivedMessage.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-3-input-with-no-output-2">Scenario 3 (input with no output)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>input</code> destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">messaging.send(<span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">delete</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="stub-runner-messaging-stream">Stub Runner Messaging Stream</h3>
<div class="paragraph">
<p>Accurest Stub Runner&#8217;s messaging module gives you an easy way to integrate with Spring Stream.
For the provided artifacts it will automatically download the stubs and register the required
routes.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In Stub Runner&#8217;s integration with Stream the <code>messageFrom</code> or <code>sentTo</code> Strings are resolved
first as a <code>destination</code> of a channel, and then if there is no such <code>destination</code> it&#8217;s resolved as a
channel name.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="adding-it-to-the-project-3">Adding it to the project</h4>
<div class="paragraph">
<p>To use it you have to add the following dependency to your project (example for Gradle):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.codearte.accurest:stub-runner-messaging-stream:</span><span class="inline"><span class="inline-delimiter">${</span>accurestVersion<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="examples-3">Examples</h4>
<div class="sect4">
<h5 id="stubs-structure-3">Stubs structure</h5>
<div class="paragraph">
<p>Let us assume that we have the following Maven repository with a deployed stubs for the
<code>streamService</code> application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">└── .m2
    └── repository
        └── io
            └── codearte
                └── accurest
                    └── stubs
                        └── streamService
                            ├── 0.0.1-SNAPSHOT
                            │   ├── streamService-0.0.1-SNAPSHOT.pom
                            │   ├── streamService-0.0.1-SNAPSHOT-stubs.jar
                            │   └── maven-metadata-local.xml
                            └── maven-metadata-local.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the stubs contain the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">├── META-INF
│   └── MANIFEST.MF
└── repository
    ├── accurest
    │   ├── bookDeleted.groovy
    │   ├── bookReturned1.groovy
    │   └── bookReturned2.groovy
    └── mappings</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following contracts (let' number it with <strong>1</strong>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>
        input {
                triggeredBy(<span class="string"><span class="delimiter">'</span><span class="content">bookReturnedTriggered()</span><span class="delimiter">'</span></span>)
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">returnBook</span><span class="delimiter">'</span></span>)
                body(<span class="string"><span class="delimiter">'''</span><span class="content">{ &quot;bookName&quot; : &quot;foo&quot; }</span><span class="delimiter">'''</span></span>)
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and number <strong>2</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">io.codearte.accurest.dsl.GroovyDsl.make {
        label <span class="string"><span class="delimiter">'</span><span class="content">return_book_2</span><span class="delimiter">'</span></span>
        input {
                messageFrom(<span class="string"><span class="delimiter">'</span><span class="content">bookStorage</span><span class="delimiter">'</span></span>)
                messageBody([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                messageHeaders {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">sample</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>)
                }
        }
        outputMessage {
                sentTo(<span class="string"><span class="delimiter">'</span><span class="content">returnBook</span><span class="delimiter">'</span></span>)
                body([
                                <span class="key">bookName</span>: <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>
                ])
                headers {
                        header(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">stubrunner.stubs.repository.root</span>: <span class="string"><span class="content">classpath:m2repo/repository/</span></span>
<span class="key">stubrunner.stubs.ids</span>: <span class="string"><span class="content">io.codearte.accurest.stubs:streamService:0.0.1-SNAPSHOT:stubs</span></span>

<span class="key">spring</span>:
  <span class="key">cloud</span>:
    <span class="key">stream</span>:
      <span class="key">bindings</span>:
        <span class="key">output</span>:
          <span class="key">destination</span>: <span class="string"><span class="content">returnBook</span></span>
        <span class="key">input</span>:
          <span class="key">destination</span>: <span class="string"><span class="content">bookStorage</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-1-no-input-message-4">Scenario 1 (no input message)</h5>
<div class="paragraph">
<p>So as to trigger a message via the <code>return_book_1</code> label we&#8217;ll use the <code>StubTrigger</code> interface as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">stubFinder.trigger(<span class="string"><span class="delimiter">'</span><span class="content">return_book_1</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to a channel whose <code>destination</code> is <code>returnBook</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AccurestMessage receivedMessage = messaging.receiveMessage(<span class="string"><span class="delimiter">'</span><span class="content">returnBook</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertJsons(receivedMessage.payload)
receivedMessage.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-2-output-triggered-by-input-4">Scenario 2 (output triggered by input)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>bookStorage</code> <code>destination</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">messaging.send(<span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">bookStorage</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll want to listen to the output of the message sent to <code>returnBook</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AccurestMessage receivedMessage = messaging.receiveMessage(<span class="string"><span class="delimiter">'</span><span class="content">returnBook</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the received message would pass the following assertions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">receivedMessage != <span class="predefined-constant">null</span>
assertJsons(receivedMessage.payload)
receivedMessage.headers.get(<span class="string"><span class="delimiter">'</span><span class="content">BOOK-NAME</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scenario-3-input-with-no-output-3">Scenario 3 (input with no output)</h5>
<div class="paragraph">
<p>Since the route is set for you it&#8217;s enough to just send a message to the <code>output</code> destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">messaging.send(<span class="keyword">new</span> BookReturned(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>), [<span class="key">sample</span>: <span class="string"><span class="delimiter">'</span><span class="content">header</span><span class="delimiter">'</span></span>], <span class="string"><span class="delimiter">'</span><span class="content">delete</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration-guide">Migration Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="migration-to-0-4-7">Migration to 0.4.7</h3>
<div class="ulist">
<ul>
<li>
<p>in 0.4.7 we&#8217;ve fixed package name (coderate to codearte) so you&#8217;ve to do the same in your projects. This means replacing <code><code>io.coderate.accurest.dsl.GroovyDsl</code></code> with <code><code>io.codearte.accurest.dsl.GroovyDsl</code></code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migration-to-1-0-0-rc1">Migration to 1.0.0-RC1</h3>
<div class="ulist">
<ul>
<li>
<p>from 1.0.0 we&#8217;re distinguish ignored contracts from excluded contracts:</p>
</li>
<li>
<p><code>excludedFiles</code> pattern tells Accurest to skip processing those files at all</p>
</li>
<li>
<p><code>ignoredFiles</code> pattern tells Accurest to generate contracts and tests, but tests will be marked as <code>@Ignore</code></p>
</li>
<li>
<p>from 1.0.0 the <code>basePackageForTests</code> behaviour has changed</p>
</li>
<li>
<p>prior to the change all DSL files had to be under <code>contractsDslDir</code>/<code>basePackageForTests</code>/<strong>subpackage</strong> resulting in <code>basePackageForTests</code>.<strong>subpackage</strong> test package creation</p>
</li>
<li>
<p>now all DSL files have to be under <code>contractsDslDir</code>/<strong>subpackage</strong> resulting in <code>basePackageForTests</code>.<strong>subpackage</strong> test package creation</p>
</li>
<li>
<p>If you don&#8217;t migrate to the new approach you will have your tests under <code>contractsDslDir</code>.<code>contractsDslDir</code>.<strong>subpackage</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migration-to-1-1-0">Migration to 1.1.0</h3>
<div class="ulist">
<ul>
<li>
<p>from 1.1.0 we&#8217;re setting JUnit as a default testing utility. You have to pass the following option to keep Spock
as your first choice:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">targetFramework = <span class="string"><span class="delimiter">'</span><span class="content">Spock</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-04-25 12:33:03 +02:00
</div>
</div>
</body>
</html>